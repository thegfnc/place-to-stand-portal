# Task 5.8: Search & Indexing (Threads/Messages)

## Overview

Introduce basic search capabilities for threads and messages with appropriate indexing to maintain performance.

## Dependencies

- 5.1 (Threads & Messages Schema)

## Deliverables

1) Indexes

- `threads(client_id, status)`
- `threads(updated_at desc)`
- `messages(thread_id, created_at)`
- Unique: `messages(type, external_id)`, `email_raw(message_external_id)`
- Optional: `pg_trgm` indexes for `threads.title` and `messages.body_text`

2) Search API (MVP)

- `GET /api/v1/threads/search?clientId=...&q=...`
- Simple `ILIKE` on title/body_text; switch to trgm when enabled

3) Observability

- Log query durations and result counts; add thresholds for slow query warnings

## Acceptance Criteria

- Reasonable performance for typical filters and basic text search on modest datasets.
- Indexes documented and applied via migrations.

## Files Changed

- `drizzle` migrations (indexes)
- `app/api/v1/threads/search/route.ts` (new)

